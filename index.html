<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Gra S≈Ç√≥wek</title>
<link rel="icon" href="favicon.ico">
<link rel="apple-touch-icon" href="icon-192.png">
<link rel="manifest" href="manifest.json">

<style>
html,body{margin:0;padding:0;height:100%;overflow:hidden;font-family:system-ui,sans-serif;
background:radial-gradient(circle at top,#fff6d8,#f1deb0)}

#menu{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:30px}
.card{background:#fffaf0;padding:30px;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.15);text-align:center;font-weight:900;max-width:320px;width:90%}
h1{margin:0 0 20px;font-size:28px}

#app{display:none;flex-direction:column;height:100%}
header{padding:8px;text-align:center}
#words{display:flex;gap:6px;justify-content:center;flex-wrap:wrap}
.word{padding:6px 12px;border-radius:999px;border:2px solid #e7d6a8;background:#fffaf0;font-weight:900;font-size:16px}
.word.off{opacity:.35;text-decoration:line-through}
.word.on{background:#eef6ff;border-color:#b9d6ff}
.word.found{background:rgba(34,197,94,.3);border-color:#22c55e}

#board{flex:1;display:grid;gap:8px;padding:12px;touch-action:none;box-sizing:border-box}
.cell{background:#fffaf0;border-radius:12px;display:flex;align-items:center;justify-content:center;
font-size:24px;font-weight:900;user-select:none}
.cell.sel{background:#c7e0ff}
.cell.hit{background:rgba(34,197,94,.45)}

footer{display:flex;justify-content:space-between;align-items:center;padding:10px}
#timer{width:64px;height:64px;border-radius:50%;
background:conic-gradient(#2563eb var(--p),rgba(0,0,0,.15) 0);
display:flex;align-items:center;justify-content:center}
#timer span{background:#fffaf0;width:46px;height:46px;border-radius:50%;
display:flex;align-items:center;justify-content:center;font-weight:900;font-size:18px}
.btn{padding:10px 14px;border-radius:12px;border:none;background:#2563eb;color:#fff;font-weight:900;cursor:pointer}
.iconBtn{
  width:46px;height:46px;border-radius:12px;border:none;
  background:#2563eb;color:#fff;font-weight:900;font-size:20px;
  cursor:pointer;display:flex;align-items:center;justify-content:center;
  box-shadow:0 6px 15px rgba(37,99,235,.3);
}
.iconBtn:active{transform:translateY(2px);box-shadow:0 3px 8px rgba(37,99,235,.3)}
.iconBtn.off{background:#6b7280;box-shadow:0 6px 15px rgba(107,114,128,.25)}

#overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center}
#modal{background:#fffaf0;padding:30px;border-radius:20px;text-align:center;font-weight:900;max-width:300px;width:90%}

/* Kontener mobilny ‚Äì dok≈Çadnie jak w ma≈Çym kodzie */
:root{--app-w:390px;--app-h:780px}
body{display:flex;align-items:center;justify-content:center;background:#d9cfae}
#shell{width:100%;max-width:var(--app-w);height:100vh;max-height:var(--app-h);margin:auto;background:inherit;overflow:hidden;position:relative}

/* STRONA WYNIK√ìW ‚Äì height:100% ≈ºeby wype≈Çnia≈Ça ekran */
#resultsScreen {
  display:none;
  flex-direction:column;
  height:100%;
  padding:20px 20px 40px;
  box-sizing:border-box;
  overflow-y:auto;
  text-align:center;
  background:#fffaf0;
  border-radius:20px;
  margin:10px;
}
#resultsScreen h1 {font-size:28px;margin:0 0 30px;}
#resultsScreen h2 {font-size:22px;margin:30px 0 10px;color:#2563eb;}
#resultsScreen p {font-size:18px;margin:8px 0;font-weight:900;}
#backToMenu {margin-top:30px;width:100%;padding:16px;font-size:19px;}

/* EKRAN WYLOGOWANIA */
#logoutScreen {
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 24px;
  padding: 40px 30px;
  text-align: center;
  background: #fffaf0;
  border-radius: 20px;
  box-shadow: 0 10px 30px rgba(0,0,0,.15);
  max-width: 320px;
  width: 90%;
  margin: auto;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 100;
}

/* NOWOCZESNE MENU */
.menuBtns{display:flex;flex-direction:column;gap:12px;margin-top:18px}
.btnFlat{
  width:100%;
  padding:14px 18px;
  border-radius:14px;
  border:none;
  background:#ffffffd9;
  color:#1f2937;
  font-size:16px;
  font-weight:800;
  cursor:pointer;
  box-shadow:inset 0 0 0 1px rgba(0,0,0,.08),0 1px 2px rgba(0,0,0,.06);
  transition:transform .16s ease, background .16s ease, box-shadow .16s ease;
}
.btnFlat:hover{background:#ffffff;transform:translateY(-1px)}
.btnFlat:active{transform:translateY(0);box-shadow:inset 0 0 0 1px rgba(0,0,0,.12),0 1px 2px rgba(0,0,0,.05)}
.btnFlat.small{font-size:15px;padding:12px 16px;font-weight:800}
.btnFlat.danger{color:#b91c1c}

.copyTip {margin-top: 8px;font-size: 13px;color: #6b6b6b;text-align: center;line-height: 1.4;}
.audioBtn {background:none !important;border:none !important;box-shadow:none !important;padding:4px !important;margin:0 4px;font-size:22px;cursor:pointer;}
.audioBtn.off {opacity:0.35;}
.resultsCongrats{text-align:center;font-weight:800;margin:30px 0 18px;}
</style>
</head>
<body>
<div id="shell">

  <!-- MENU G≈Å√ìWNE -->
  <div id="menu">
    <div class="card">
      <h1>üáµüá± Gra S≈Ç√≥wek</h1>
      <p>Wybierz rozmiar planszy:</p>
      
      <div class="menuBtns">
        <button class="btnFlat" data-size="5x6">Plansza 5 √ó 6</button>
        <button class="btnFlat" data-size="6x7">Plansza 6 √ó 7</button>

        <button class="btnFlat small" id="showResults">üìä Wyniki gry</button>
        <button class="btnFlat small danger" id="exitBtn">üö™ Wyj≈õcie</button>
        <button id="copyLinkBtn" class="btnFlat small">üìã Skopiuj adres gry</button>
        <div class="copyTip">
          ‚ö†Ô∏è Tip: najlepiej skopiowaƒá link i otworzyƒá w <b>Chrome</b> ‚Äì wtedy mo≈ºna dodaƒá grƒô na pulpit i ≈õledziƒá swoje rekordy.
        </div>
      </div>
    </div>
  </div>

  <!-- GRA -->
  <div id="app">
    <header><div id="words"></div></header>
    <div id="board"></div>
    <footer>
      <div style="display:flex;align-items:center;gap:10px">
        <div id="timer" style="--p:100%"><span id="time">60</span></div>
        <button class="iconBtn audioBtn" id="toggleTick" title="Tykanie zegara">üïí</button>
        <button class="iconBtn audioBtn" id="toggleSound" title="D≈∫wiƒôki">üéµ</button>
      </div>
      <div style="display:flex;gap:8px">
        <button class="btn" onclick="goFullscreen()">‚õ∂</button>
        <button class="btn" id="back">MENU</button>
      </div>
    </footer>
  </div>

  <!-- WYGRANA/PRZEGRANA -->
  <div id="overlay">
    <div id="modal">
      <div id="msg"></div><br><br>
      <button class="btn" id="again" style="width:100%;padding:16px;font-size:19px">ZAGRAJ PONOWNIE</button>
    </div>
  </div>

  <!-- STRONA WYNIK√ìW -->
  <div id="resultsScreen">
    <h1>Wyniki Gry</h1>
    <div id="globalStats"></div>
    <div id="lastSessionStats"></div>
    <div id="todayStats"></div>
    <button class="btn" id="backToMenu">POWR√ìT DO MENU</button>
    <div class="resultsCongrats">GRATULACJE WYNIK√ìW !!!</div>
  </div>

  <!-- EKRAN WYLOGOWANIA -->
  <div id="logoutScreen">
    <h1 style="font-size:26px;margin:0 0 20px;">üëã Zosta≈Çe≈õ wylogowany</h1>
    <p style="font-size:18px;line-height:1.5;margin:0;">
      Zosta≈Çe≈õ wylogowany z gry.<br><br>
      Mo≈ºesz teraz <strong>bezpiecznie zamknƒÖƒá przeglƒÖdarkƒô</strong><br>
      i powr√≥ciƒá kiedy tylko chcesz.
    </p>
    <button class="btn" style="margin-top:30px;padding:16px;width:100%;" id="backFromLogout">
      üîÑ POWR√ìT DO MENU
    </button>
  </div>

</div>

<script>
(() => {
  const WORDS = ["DOM","LAS","SEN","D√ì≈Å","B√ìL","TOR","MUR","≈ªAR","KƒÑT","≈ÅAN","EGO","LOS","CEL","MOC","R√ìJ","T≈ÅO","FON","KOD","RYM","MIT","SOK","LOT","RAP","ART","TYP","EKO","SYN","≈ÅAD","TON","WAT","GAS",
    "WODA","KAWA","RYBA","LATO","ZIMA","OKNO","RƒòKA","≈ªABA","≈Å√ìD≈π","NOCƒÑ","MAKI","LASY","KOTY","DOMY","DUCH","MOCY","≈öLAD","KIER","ZNAM","IDEA","FALA","MOST","T≈ÅUM","FORMA","≈öWIT","CIE≈É","NUTA",
    "KWIAT","LI≈öƒÜ","WIE≈ö","G√ìRA"].filter(w => w.length >= 3 && w.length <= 4);

  const BASE_TIME = 60;
  const ALPH = "AƒÑBCƒÜDEƒòFGHIJKL≈ÅMN≈ÉO√ìPQRS≈öTUVWXYZ≈π≈ª";
  const DIRS = [{dr:0,dc:1},{dr:1,dc:0},{dr:1,dc:1},{dr:1,dc:-1},{dr:0,dc:-1},{dr:-1,dc:0},{dr:-1,dc:-1},{dr:-1,dc:1}];

  const menu = document.getElementById("menu");
  const app = document.getElementById("app");
  const board = document.getElementById("board");
  const wordsEl = document.getElementById("words");
  const overlay = document.getElementById("overlay");
  const msg = document.getElementById("msg");
  const back = document.getElementById("back");
  const again = document.getElementById("again");
  const timeEl = document.getElementById("time");
  const timerEl = document.getElementById("timer");
  const showResultsBtn = document.getElementById("showResults");
  const resultsScreen = document.getElementById("resultsScreen");
  const backToMenuBtn = document.getElementById("backToMenu");
  const globalStatsEl = document.getElementById("globalStats");
  const lastSessionStatsEl = document.getElementById("lastSessionStats");
  const todayStatsEl = document.getElementById("todayStats");
  const exitBtn = document.getElementById("exitBtn");
  const logoutScreen = document.getElementById("logoutScreen");
  const backFromLogout = document.getElementById("backFromLogout");
  const toggleTick = document.getElementById("toggleTick");
  const toggleSound = document.getElementById("toggleSound");
  const copyLinkBtn = document.getElementById("copyLinkBtn");

  let GAME = { rows: 6, cols: 5 };
  let words4 = [];
  let active = new Set();
  let found = new Set();
  let grid = [];
  let cells = [];
  let timer = null;
  let timeLeft = BASE_TIME;
  let dragging = false;
  let startCell = null;
  let path = [];
  let activeCount = Math.max(1, Math.min(4, Number(localStorage.getItem("ACTIVE_COUNT")) || 2));

  // D≈πWIƒòKI
  const clickSound = new Audio('sounds/click.mp3');
  const tickSound = new Audio('sounds/tick.mp3');
  const recordsMusic = new Audio('sounds/records_loop.mp3');
  const fanfareSound = new Audio('sounds/fanfare.mp3');
  const loseSound = new Audio('sounds/lose.mp3');

  clickSound.volume = 0.6; tickSound.volume = 0.6; recordsMusic.volume = 0.9; recordsMusic.loop = true;
  fanfareSound.volume = 0.4; loseSound.volume = 0.8;

  function safePlay(audio) { audio.currentTime = 0; audio.play().catch(() => {}); }

  document.addEventListener('click', () => {  // odblokowanie d≈∫wiƒôk√≥w
    [tickSound, recordsMusic, fanfareSound, loseSound].forEach(safePlay);
  }, { once: true });

  document.addEventListener('click', (e) => {  // klikniƒôcie na przyciskach
    if (e.target.closest('.btn, .btnFlat')) safePlay(clickSound);
  });

  // Prze≈ÇƒÖczniki d≈∫wiƒôku i tykania
  let tickOn = localStorage.getItem("TICK_ON") !== "false";
  let soundOn = localStorage.getItem("SOUND_ON") !== "false";
  toggleTick.classList.toggle("off", !tickOn);
  toggleSound.classList.toggle("off", !soundOn);
  toggleTick.onclick = () => { tickOn = !tickOn; localStorage.setItem("TICK_ON", tickOn); toggleTick.classList.toggle("off", !tickOn); };
  toggleSound.onclick = () => { soundOn = !soundOn; localStorage.setItem("SOUND_ON", soundOn); toggleSound.classList.toggle("off", !soundOn); };

  // Kopiowanie linku
  copyLinkBtn.onclick = () => {
    navigator.clipboard.writeText(location.href).then(() => alert("Link skopiowany!")).catch(() => alert("Nie uda≈Ço siƒô skopiowaƒá."));
  };

  // Statystyki (pozostawione bez zmian)
  if (!localStorage.getItem("gameStats")) {
    localStorage.setItem("gameStats", JSON.stringify({startDate: new Date().toISOString().split('T')[0], stats: {}}));
  }

  function getStats() { return JSON.parse(localStorage.getItem("gameStats")).stats; }

  function updateStats(win) {
    const today = new Date().toISOString().split('T')[0];
    const stats = getStats();
    if (!stats[today]) stats[today] = {wins: 0, losses: 0};
    stats[today][win ? "wins" : "losses"]++;
    localStorage.setItem("gameStats", JSON.stringify({startDate: JSON.parse(localStorage.getItem("gameStats")).startDate, stats}));
  }

  function showResults() {
    menu.style.display = "none";
    resultsScreen.style.display = "flex";
    safePlay(recordsMusic);
    // ... (kod wy≈õwietlania statystyk ‚Äì bez zmian)
    const dailyStats = getStats();
    const today = new Date().toISOString().split('T')[0];
    let totalWins = 0, totalLosses = 0;
    for (const d in dailyStats) { totalWins += dailyStats[d].wins || 0; totalLosses += dailyStats[d].losses || 0; }
    globalStatsEl.innerHTML = `<h2>Og√≥lne</h2><p>Wygrane: <strong>${totalWins}</strong></p><p>Przegrane: <strong>${totalLosses}</strong></p>`;
    const todayWins = dailyStats[today]?.wins || 0;
    const todayLosses = dailyStats[today]?.losses || 0;
    todayStatsEl.innerHTML = `<h2>Dzi≈õ (${today})</h2><p>Wygrane: <strong>${todayWins}</strong></p><p>Przegrane: <strong>${todayLosses}</strong></p>`;
    // ostatnia sesja ‚Äì uproszczone
    lastSessionStatsEl.innerHTML = `<h2>Ostatnia sesja</h2><p>Sprawd≈∫ powy≈ºej</p>`;
  }

  // KLUCZOWA POPRAWKA ‚Äì przyciski wyboru planszy
  document.querySelectorAll("[data-size]").forEach(btn => {
    btn.onclick = () => {
      const [cols, rows] = btn.dataset.size.split("x").map(Number);  // 5x6 ‚Üí cols=5, rows=6
      GAME = { rows, cols };  // POPRAWIONE ‚Äì bez zamiany miejsc!
      updateBoardCSS();
      startGame();
    };
  });

  function updateBoardCSS() {
    board.style.gridTemplateColumns = `repeat(${GAME.cols}, 1fr)`;
    board.style.gridTemplateRows = `repeat(${GAME.rows}, 1fr)`;
  }

  // reszta funkcji gry (pick4, renderChips, buildGrid itd.) ‚Äì bez zmian, dzia≈ÇajƒÖ idealnie
  function pick4() {
    const pool = WORDS.slice();
    const out = [];
    while (out.length < 4 && pool.length) out.push(pool.splice(Math.floor(Math.random() * pool.length), 1)[0]);
    while (out.length < 4) out.push("DOM");
    return out;
  }

  function applyActiveFromCount() { active = new Set(words4.slice(0, activeCount)); }

  function renderChips() {
    wordsEl.innerHTML = "";
    words4.forEach(w => {
      const s = document.createElement("span");
      s.className = "word off";
      s.textContent = w;
      s.onclick = () => {
        if (active.has(w)) { if (active.size <= 1) return; active.delete(w); } else active.add(w);
        activeCount = active.size;
        localStorage.setItem("ACTIVE_COUNT", activeCount);
        found.clear();
        buildRound();
      };
      wordsEl.appendChild(s);
    });
    updateChips();
  }

  function updateChips() {
    [...wordsEl.children].forEach(chip => {
      const w = chip.textContent;
      chip.className = "word " + (found.has(w) ? "found" : active.has(w) ? "on" : "off");
    });
  }

  function buildGrid() {
    const g = Array.from({length: GAME.rows}, () => Array(GAME.cols).fill(null));
    const list = [...active];
    for (let i = list.length-1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [list[i], list[j]] = [list[j], list[i]]; }
    for (const w of list) {
      for (let t = 0; t < 500; t++) {
        const d = DIRS[Math.floor(Math.random() * DIRS.length)];
        const r0 = Math.floor(Math.random() * GAME.rows);
        const c0 = Math.floor(Math.random() * GAME.cols);
        const rE = r0 + d.dr * (w.length - 1);
        const cE = c0 + d.dc * (w.length - 1);
        if (rE < 0 || rE >= GAME.rows || cE < 0 || cE >= GAME.cols) continue;
        let ok = true;
        for (let i = 0; i < w.length; i++) { if (g[r0 + d.dr * i][c0 + d.dc * i] !== null) { ok = false; break; } }
        if (ok) {
          for (let i = 0; i < w.length; i++) { g[r0 + d.dr * i][c0 + d.dc * i] = w[i]; }
          break;
        }
      }
    }
    for (let r = 0; r < GAME.rows; r++) {
      for (let c = 0; c < GAME.cols; c++) {
        if (g[r][c] === null) g[r][c] = ALPH[Math.floor(Math.random() * ALPH.length)];
      }
    }
    return g;
  }

  function renderBoard() {
    board.innerHTML = "";
    cells = [];
    for (let r = 0; r < GAME.rows; r++) {
      for (let c = 0; c < GAME.cols; c++) {
        const el = document.createElement("div");
        el.className = "cell";
        el.textContent = grid[r][c];
        el.dataset.r = r; el.dataset.c = c;
        board.appendChild(el);
        cells.push(el);
      }
    }
  }

  function idx(p) { return p.r * GAME.cols + p.c; }
  function clearSel() { cells.forEach(el => el.classList.remove("sel")); }
  function paint(p) { clearSel(); p.forEach(x => cells[idx(x)].classList.add("sel")); }

  function line(a, b) {
    const dr = b.r - a.r, dc = b.c - a.c;
    const sdr = dr === 0 ? 0 : (dr > 0 ? 1 : -1);
    const sdc = dc === 0 ? 0 : (dc > 0 ? 1 : -1);
    const adr = Math.abs(dr), adc = Math.abs(dc);
    if (!((adr === 0 && adc > 0) || (adc === 0 && adr > 0) || (adr === adc && adr > 0))) return [];
    const n = Math.max(adr, adc);
    const out = [];
    let rr = a.r, cc = a.c;
    for (let i = 0; i <= n; i++) {
      out.push({r: rr, c: cc});
      rr += sdr; cc += sdc;
    }
    return out;
  }

  board.addEventListener("pointerdown", e => {
    const el = e.target.closest(".cell");
    if (!el) return;
    dragging = true;
    board.setPointerCapture(e.pointerId);
    startCell = {r: +el.dataset.r, c: +el.dataset.c};
    path = [startCell];
    paint(path);
  });

  board.addEventListener("pointermove", e => {
    if (!dragging) return;
    const el = document.elementFromPoint(e.clientX, e.clientY)?.closest(".cell");
    if (!el) return;
    const cur = {r: +el.dataset.r, c: +el.dataset.c};
    path = line(startCell, cur);
    paint(path);
  });

  board.addEventListener("pointerup", () => {
    if (!dragging) return;
    dragging = false;
    clearSel();
    if (path.length >= 3) {
      const txt = path.map(p => grid[p.r][p.c]).join("");
      const rev = txt.split("").reverse().join("");
      for (const w of active) {
        if (found.has(w)) continue;
        if (txt === w || rev === w) {
          found.add(w);
          updateChips();
          path.forEach(p => cells[idx(p)].classList.add("hit"));
          if (found.size === active.size) win();
          break;
        }
      }
    }
    path = [];
  });

  let lastSecond = -1;
  function startTimer() {
    clearInterval(timer);
    timeLeft = BASE_TIME;
    timeEl.textContent = timeLeft;
    timerEl.style.setProperty("--p", "100%");
    lastSecond = -1;
    timer = setInterval(() => {
      timeLeft--;
      timeEl.textContent = timeLeft;
      timerEl.style.setProperty("--p", (timeLeft / BASE_TIME * 100) + "%");
      if (timeLeft !== lastSecond && timeLeft > 0) {
        lastSecond = timeLeft;
        if (soundOn && tickOn) safePlay(tickSound);
      }
      if (timeLeft <= 0) lose();
    }, 1000);
  }

  function win() { updateStats(true); if (soundOn) safePlay(fanfareSound); end("üéâ Gratulacje!<br>Znaleziono wszystkie s≈Çowa!"); }
  function lose() { updateStats(false); if (soundOn) safePlay(loseSound); end("‚è±Ô∏è Czas siƒô sko≈Ñczy≈Ç!<br>Spr√≥buj jeszcze raz."); }
  function end(text) { clearInterval(timer); msg.innerHTML = text; overlay.style.display = "flex"; }

  function buildRound() {
    overlay.style.display = "none";
    found.clear();
    grid = buildGrid();
    renderBoard();
    updateChips();
    startTimer();
  }

  function startGame() {
    resultsScreen.style.display = "none";
    logoutScreen.style.display = "none";
    recordsMusic.pause(); recordsMusic.currentTime = 0;
    menu.style.display = "none";
    app.style.display = "flex";
    words4 = pick4();
    applyActiveFromCount();
    renderChips();
    buildRound();
  }

  back.onclick = () => { clearInterval(timer); app.style.display = "none"; menu.style.display = "flex"; };
  again.onclick = () => { words4 = pick4(); applyActiveFromCount(); renderChips(); buildRound(); };
  showResultsBtn.onclick = showResults;
  backToMenuBtn.onclick = () => { recordsMusic.pause(); recordsMusic.currentTime = 0; resultsScreen.style.display = "none"; menu.style.display = "flex"; };

  exitBtn.onclick = async () => {
    if (document.fullscreenElement) await document.exitFullscreen();
    clearInterval(timer);
    recordsMusic.pause(); recordsMusic.currentTime = 0;
    menu.style.display = app.style.display = overlay.style.display = resultsScreen.style.display = "none";
    logoutScreen.style.display = "flex";
  };

  backFromLogout.onclick = () => { logoutScreen.style.display = "none"; menu.style.display = "flex"; };

  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./service-worker.js").catch(() => {});
    });
  }

  menu.style.display = "flex";
  app.style.display = "none";
})();
</script>

<script>
function goFullscreen() {
  const el = document.documentElement;
  if (!document.fullscreenElement) {
    if (el.requestFullscreen) el.requestFullscreen();
    else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
    else if (el.msRequestFullscreen) el.msRequestFullscreen();
  } else {
    if (document.exitFullscreen) document.exitFullscreen();
    else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
  }
}
</script>

</body>
</html>
